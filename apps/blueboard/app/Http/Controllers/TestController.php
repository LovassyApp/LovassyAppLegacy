<?php

namespace App\Http\Controllers;

use App\Events\GlobalEvent;
use App\Events\ProductUpdated;
use App\Events\TestEvent;
use App\Events\UserGroupUpdated;
use App\Helpers\LibCrypto\Models\SodiumKeypair;
use App\Helpers\LibCrypto\Services\EncryptionManager;
use App\Helpers\LibSession\Services\SessionManager;
use App\Models\Product;
use Illuminate\Http\Request;
use App\Models\User;
use App\Models\UserGroup;
use Illuminate\Encryption\Encrypter;

class TestController extends Controller
{
    // Kérlek ezt ne hagyd benne a productionben.
    // Előre is köszi: A múltbéli éned.
    public function index()
    {
        $json =
            '{"key_encrypted":"5aea57fc220c0ac8155a7c3ffd3d7f70db0885583bffe3e950839d96c376620c6800cfd7ef9a8e8ace3b4d0d9b116c2c1f7329a8256516d9dff3bf8ff73c70f82b9b9db77eb59fd13395cb332c8ccf77","message_encrypted":"eyJpdiI6InJCQjk5anBKWTRTemJVMDRwdXNyeWc9PSIsInZhbHVlIjoiajNOSTRWMFRPWjgvM25uZkNyeWF4akpEb0hRTWVESVppb1haV1VmVGE0bmpTTlNVU2pZc0h4V3NGbjltMit1VkhLa2Rwd1lxQXZob2dURHBFWlJ4WWkyOCtJQ0R4eTdsblhpb0xZcFB1bTYzV2VGenRkR0JhZ01MNjhEMUpoQ2cxbEgzZ2w2cTFvTmJ5UzFOT1J1TzdseUZmRGIrdkVxTGh6MnJSa1cyaTAzUXg1b3ZFcjJIV09wTmdscGYxYkpOalpLZVhqQWhTMnY0eU5MSHg0b1V6dGJnLy9zZHNZS1pKNzlTRWpPQ1RBdFJHM3JCZmNiYnA3Zm5FaXp0VWFPMEFUYVdRSExrSjVnSlRaZ0YrR2tuVjZBeFlqcFRkd3FxVG5aNHg4a2xickVzVy84b1owdmFaV1ozQ1NPQVZibDNnOS9td2gyQVgzbmJwZjVieUVWeFBhVGtjcEJmQjkvc0pwT1ZWcVd3RFFpbFgwK29LeTROamtmWmNPZkRDK2EvcTVtQ3ZEQmd3SnNZU25meFlvdUdEbWh6SkF2c0VSdjJOKzhwTE5aSFB0SzZQaGlCaS9zaW1yeEdJNGhjT1d4YWIzY2pFZm54SEZQQXNYcUM1cXh3N2Jqem5BTFkxanhJdUczOStYQ0ZQQ1RkQlRBOXExd0NqdE42ZkxNeGd3VnQwV25OYTJKd2tadmZhaS9PTElJL0hBUHd2UHBvUXNmYS9XenhKVWFaVWpORXZVNEdjWE03SmU3MXVnVERsVUxLWFNZNkNtY0J4YnFTU0huMGdLTFkwN3NndDlJSlUvbWxWR1RoM3NkY2txaVJ2RTU1akVMRVAzSGpPUmIyRVJhdnpyeTVNOVZSWXdZQmVpdjJBcW15TDBTR3ZuYXZaQmo1WkRyZlY3UWpXU1ErNlN2c3ZWc2JZZERESEQ2NVhhS3QzdDBQbVZJeUpCRHZkZkRMTnNsY1hrc3JjVXQ1SVB4bzNySmpUcWMyREJESXdYZ1ZTa0xBOHpHZGxuTTZtZW9WcURudy9uU0hlZFJ4cGxFUDFMQ3FjZU1XQ3lHYkNLcnN5bUIxYzY4bGlZb2lLSitKRjVOSUxTUEI1NjFEZUxmT1hMcHJ1QzRaRmZuM0ovLy9vSFpaVzRSNUJDaVRZQmd0eFRLdElHUnJaSkhra3lpRjlRR0hZdzRLM21KL3E5L3pYQTJOdEsvOXdsWStqUlhFR3JveFZGbXEyaEZJODY3ZFhNQ1A4WDBIVlgyaFBIbWhJaUlLTGJRcU1Ha2I1cndBQVRBTHVBdUd0bUkxNzVTV3JwYmZKeEs5NXM5WmdoZy9QMDcvMGFBWU12MU1BZmhqUzlFQzVxSWVqWCtNR3E4Yy82aFpxOTgrQzg1bXlLVVRHd1BvcDhNRUo2akRyKzJONW1iQjdpa2ZJVXZQdVdwRk1MWkVRc1I3UUJtN3VKRlhZM0lXNGE5dmkxNXE2TW9JditMempoMVBsdXJLVEtpTWs2UUFCTEozd0M5cUViMXlaWmtsY29LcjBLcVQ4dFVoSWI1MDRXaldhYnY4QmdzcmZUVEJKeEJZT0pDd3J0aThUMzNjMU1yVHdPZzJkMU1sWlRXU01zdlR6cExzTlZJS2JBcGVBZ21Fb1J0bFVkMzVpYWFCbHgxdmdabHl1dVB3TWdHVGF2MHE5UmtHZnR5TXhzMUYvbjhCdWgwdGEvMmRzWE83RVRYZk5pakxvL1hha05aSTZUVlU1VFEwb21BQisyZ0Z2TW5WbnRxTEIxY05NbDQrb3JZNW1LcnRsMi85bTdCMEtNaUh2L1hxMHNwNUozcktKTjNOdDlXOTlDMWtGem1hblRkSWFyaFVUZEFaVHRQQ2F3dnh2dVNjdUswd0VYTEVvMVlZOEFJeVIwcWM5T0p5Rmx4V1k1TFF1MTB1MUE0L2lKTUFGSjBTSTArTkNhajUzZWt1VmhRM09IK1FROExYUnVnTitMQ0w3MHJIc045ZFhDaFlWNkpmWTBNbmpKNnBuWFNyV1gzQ0dMdDNNM00xYVFIcW14Si8vK3REajk0NXNmbUFmYjg0ZTNNS2JOa1FMWDg1bXNLbWZ4WjNQUGFKTVNqWFNRckxnc2YxVEUzcVplc0hsQ1hqaURVclZlK24wMGtVU0s1VHhXVkFrNXphQVhCdzVGTXhEUlJYVFlpUENMZUVvb25RWVJienVycG1zNEFnWmxHUW5WQ3pzbUxYK256UVZDTThmWGVCYzMvSitZWEJFTXpyWU04cThQbmNTUVBndjlDaVFBMlBJbThzUEZMZ2krSW1KUkkvZnVFMCtuWEpFRTFGRWlBNi9nNDRHQ2hVRWMwcU00d01XbW1xdmVscHFITWVINTBLS0F5aWxtWUZLc25sK0ZnbFc1UFNRNTRqREhBSWNlRlB2S3hDeVZXSERad3lRemREQlZqWFRtcWdQa1JuZHRRcmE5VDJkWmpGbVJ6MkNjQmtRM1Jxc3ZPU1l2OUhKMlVIbVJrN1N1ckV3K0FZVWxXa2JmTE1WRm5OSXA5VGNwZG1ra2pDSmVLUEkxNXVwSFo2aDZkWmNORFRWVkxNVzNLN0c1SnprVTFmN2Z5N3YvVFdySHJqNE14U21YcFM4eTlMalVEa05Ud0hpSlBoSVQyR3F3dlc0QVpUYVh6ZEdjNXArZTYveFI4WGh5MmVFMnhINnJNOHNheWM4by94NlVXV2xlVXdHVm8zZjFsSVhOMHA0WWVDY21mL0hJUHl3L2E2WEwwOFVsSmV4SlJtU3hKWjBxUWlDbFJHQlBwalR4aFhWaEpDZ0FaQXBhZ2xUclhkd1pCekliSXE1NmJoOHpLbVJCL01BbTBaSExSOEtvQjRvNm1Qb1lTY2hUbXlnQXhZN28zWDIwRnNISkg0Vk1BM2RQM1hqTksxSGlXR1FlQS8vemdkK2oxOUVtQ0phN2xlSllib0l4azRwRVRGVmpCdFRKbEtMbGs4Q2lZMGZsc1VBQXNMa25jMnYzNWc2dUNnN0lZQXZsaUF1bnBydkZpdUMwTlFSNkU3RGRpM1pSNGwxa21zWXZiSGNIMFNqNHkrL1craTBiMlVmVEgxdjlJRERCM25HOHk5SDVFLzZWUzhtRnhRZ3g3MG01YVVBUHZEWmtTY3lqRk00OUVnWlU0SEUzQ2ZGQllpWDA2MmNUd0JxRCtGQ0FDdFI0REd3K0lISnJIZFJIcHFpeU5nUGkzSStPaHl0ME9VYnpRTkFWWkZwZm1LS3NVR0FldWk2Wms0VHFxRGw5MHpSZ2VFQkpMRklmNWYzNkwwaXVOQ1IyWVNCc2M4TjdqVGhEZTVsdm5HUXZWL28wR2M0L0RnUSsxdURsTTRNb1ZUK0lJdUU2RUVSSlViZjZnSFNhWDJ0RzBMcWtsMEM0MU9UcGJGQzVCZTFRZmVVL0Q2TVZRMGhMd2taVVFSaXpFYy9LTXpLWU51My9BWS9ocVRCcjMwZm1mWFVDZFgzcEFMeEZiY3VrbEppQUI5dCt1WW1HQldtdnhqTmF1UHZyNFR3YldRZlF6MHNiWmFIUXBqUlpmdi9MRFdRNjJlYld6TGNyOWlIM1lhQi9DZ2JsRXVmdXRTTXRGaU5iTnJISzBBQnU2RFo0ZU1pNE9LZitjcE91Y2tJdml5Qi9teXVUUi9YVWRUSk1KUmJWOEoxemdkU1R3ZnBsdlVZWFRzSDk4YUxTRTk3OGUyMEppMmprcGVDMXd0OUlCTUt2MjJwdWJUd2ZTTkYxYzVKR3MzN3U4NStaZjhIODgrZHBxRnh4S0FUWVNYcXI1RWZ0aVhVWWFkU2VRNnVPaW1TSDFSK1JYUTYzZE9NYlZ5NWp1VnJGMVNIUk9INThvY2FVRmlTd0ZDcmhvcUhYOHFhOHRmOFlITkwwVlBHazVRMXVDZkJ6cVpzYll3dmdXVzdQMzRHbTVSblNxNWlIUFBwRUMrb1hJYmprZndySDZReEtPVkoyS1prWUxoTHhsYkFpd2I0NWlUNUorZW5UZG5DcjJKcWR4clg4SGFxc2tQWlJaMmROV09nVFFCaWZkak9mY0sraEh2S21zNDVoelNGVjNBYWxzVWlQeHBvYkt1T1o2eVNZTUJMMXJzUUY5b3JxQ0dyMDJnSlJuYXNOVDkwN0JXZDUyeWpSSFlqY3NLNURSUXo0QmpJaFRLbFVnWFVTMmlwejJrcWpuT3MrM2lySE5nMmdaRXdKQk8vTHN4c1U4YURRT2RDd1lNaVBLalRROWJrUzBDYWZ3dkFFNDlnckdWUTlsNVhIUUp6ekFQZDVPY0drY05BQllWMzlZc2pzdHlQMW5mVnI5b0xXTk5tK05RQVlybSt5UjJUTTlUM0lrQ0IxRlk4cGlqTXlnQzdqY0VUR2hFeWh3TWNJZ0FlUWQ0d3IydGN2MExFODMxMSs2R1lyTTBVc0hBTzZWbVlhekx3dW9aUEZxM1VJWlFIWGtiMDlKVVQwclp0VE41cHV2NU94Skc1VENCeDdCSjVDZjNJbnVTc2prVzZMRXFPOEVQdW11eTlVc0ZQZE9KY0Rtd3NHdVE1cC81ZGhESnB1S3pJTXN5VUtzc1J2Y3FkalQxRzRpaDFsL3VJUG1xZzFHck1YRFBlY0txOUFiTnZzYWZvZjYzcUl1ejRydWNWNTJ1ek4xVTVPNEZRVVhiUVJFTUtDUk5tSnB3bGJsWUU2MldOSG44TmZnVjdQdHh5QmlDMHNZVTlIYXE5b2lTdVZCclorcGN1TzFvbFhXZFM1c1dXdmZrM1QvdUhYWjlYWldCRytIYlhMZHYvbGVSNTVUTG5JM0o5ME13MENwN1RkRU5YSVZwSkRFRGZ1dTd4dHBUblpTaTgxMXNmbjVoQ3g3eDFIbmQ3cGlLZGpXS0F5SHh6cjFkL1VSMzB2Qm9rQ3FQWmxqMlFCYWlwNFRzSkgwMEhsazd6UGh4RTZhY0IwVjRDSkw5QWNaN3cvYXNoek0ra2laZlV6bmhPVEpLQ3ZhUE11d0lvVWhqZlkwQkpoTHh2U2FKTUx1eTUwWmZrRWIvYWFuS2dDckZaTUkyZXluSEpUOEdQR1F6c1NJeXFrZktMempRMDhWdUtGdGphR0V5cHJDU1RweEIyOHhDQTI4ZVZLNEJGUE9JellkYjhKUHJVdFI3NDNFZEpEV2xuUXNwUThsZitLVElNSCt5VzhIVUgyYmU1YlRrdFZSOVNEakRCdUtTemVob2hYMmxjb1VjS2M1d3RHZVdVRk9DMG1nTzFrNlRQQ0hhdFFibWdKOHBVdXFTSm54YmhLKzJna2ZJOEJRZzlWR2IraU13eDhyeENvMmdPc3VvK2NhS3lzKy80NmdQZ3I5c1Rqc2NQTzYwK21QZXFZQk1HNzF6STJjK0xOUW01blRFWHBpVU9IcTlQTDlVbVBmakZKTmNrL3FnQnpJc3JVTlJuQU5RTnQvcDRBNEpNcndMRHhUNWVUbjJQd1dtUXBwMnV0U0pLZjZHWGdpT2ZBbFltNzhlUGQyQitJSUlkTTY3RXZRYUQyVmpmVDZKZ0tINHNIcnN1aWl6UW4xS3RoUWJUbDR1VkUzVWlHTFd3TDdHR3g1dm4vaGlud1RXRW11T0lHYXpWcHM5c2Mvd3Q2UGxZSUhFNDQ0MTNQa1d2ZXh3eHFXZExtZEVWd1A2ZENvVVhZbE9wR0VDUng1V2NsdDV4SGxCcVJtOW9TdXlkVG1JNVVrMjczUnpYTTZOdHhIUTQyU1VMem9IRW03UnZDZTZBR3YxSlkwblVzR0JBZ254blpIUHVHdmsvWm1uSUpISGlYbjg2SWhYME5zZS9sWEg1UXZyaG9WdVV6dDRHUFAyVkJQNlFDZjBUY2lNUzlBN2JhT2g0UnVTR242V3FFdDdwYk9oRnIySmVtWVk5Szc5NXEyN2hPcGFOeTJKcjBEeHJVTm5nazBEdTZWS3o1YTVFVkZTYnFHNFNJL3pQN04rRjZLczZkSzdORVNETnJrOFMrUGVOeGd2OUg5bnJCaytnQjlNRjZlVFNWcVowVVE0Y3JiQjNwMXkwZHlxQlJzR1RrVG1MV3VtT25WK090U3JhcXpkSXpNOFFoM2hBaXdaL1ZFYmFFS0hUV1BvZ25oWmxUMGpPT3hjaFV0eDFPajhTenp6R1ptTG1CSk5oQ0hZd2tHQW8vNFZsMzdwbElpb0RnTFRkMVpYTWFtSVlOYnhVbmV4bnVtc29VV0xXeXpaakNhWlJSQkFYSzBBc3BtTXZZS0FLUjJHMENGSjFEUHFLUGZWeUhTdW9wNGVndHhjaytLdUhzRGgzQXBlNE5IZ2k5enExQmlXTFdvS0JRZjR4WVFGTG9PZVJCYUZqdmhvaHNXa0Zxc25YVXFnZ0xQajNqbzVvM3VzaldoSjk0REZhbDdURi9TNXBFN0s1KzFTcXhncmp5SXh4MmFEc01vZnNhRnBQMUVKYnVXelNaUHBJY0hTeGJEb2pYOFBwZFJ4cmFVWExNNG5tRVlvVnRZcFNJM0dyTlF6Z3d4bHdiaGtnM0xZZG03VlBVSXNBN2M9IiwibWFjIjoiYzI0NmMxNTU2N2VkOGJiZTYxZWI1NDgwYjJjYjM3NmQ3NWUzY2VjNTQ2MTQ0OWM5NDhjOTJmOWUyYzFiODQ2OCJ9","user_id":2}';
        $obj = json_decode($json);
        dd($obj);
        $user = User::find($obj->user_id);
        $key = EncryptionManager::use()->decrypt($user->private_key_encrypted);
        $keypair = new SodiumKeypair($key);
        $aeskey = $keypair->decrypt($obj->key_encrypted);
        $enc = new Encrypter($aeskey, 'aes-256-cbc');
        dd($enc->decryptString($obj->message_encrypted));
    }
}
